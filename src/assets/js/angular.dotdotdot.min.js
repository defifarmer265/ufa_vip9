/*! angular.dotdotdot 2015-04-01 9:59:23am */
(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(a){this.$window=a,this.loadDot=c(this.loadDot,this),this.getWindowDimensions=c(this.getWindowDimensions,this),this.windowWatcher=c(this.windowWatcher,this),this.post=c(this.post,this),this.compile=c(this.compile,this),this.setStringTrim()}var b,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return a.prototype.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},a.prototype.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}},a.prototype.restrict="A",a.prototype.scope={dotOptions:"=?dotdotdot"},a.prototype.setStringTrim=function(){return String.prototype.trim?void 0:function(){return String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}()},a.prototype.compile=function(){return{post:this.post()}},a.prototype.post=function(){return function(a){return function(b,c,d){return a.$scope=b,a.$attrs=d,a.dot=c[0],a.loadDot()}}(this)},a.prototype.update=function(a,b){var c,f;return a.preventDefault(),a.stopPropagation(),this.opts.maxHeight="number"==typeof this.opts.height?this.opts.height:n(this),this.opts.maxHeight+=this.opts.tolerance,"undefined"!=typeof b&&(("string"==typeof b||d.call(b,"nodeType")>=0&&1===b.nodeType)&&(b=angular.element("<div />").append(b).contents()),b instanceof $&&(this.orgContent=b)),this.$inr=angular.element(t(this,angular.element('<div class="dotdotdot" />'))).children(),this.$inr.contents().remove(),this.$inr.append(this.orgContent.clone(!0)).find("br").replaceWith("  <br />  ").css({height:"auto",width:"auto",border:"none",padding:0,margin:0}),c=!1,f=!1,this.conf.afterElement&&(c=this.conf.afterElement.clone(!0),this.conf.afterElement.remove()),s(this.$inr,this.opts)&&(f="children"===this.opts.wrap?e(this.$inr,this.opts,c):g(this.$inr,this,this.$inr,this.opts,c)),this.$inr.replaceWith(this.$inr.contents()),this.$inr=null,angular.isFunction(this.opts.callback)&&this.opts.callback.call(this,f,this.orgContent),this.conf.isTruncated=f,f},a.prototype.truncated=function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(this,this.conf.isTruncated),this.conf.isTruncated},a.prototype.getOriginalContent=function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(this,this.orgContent),this.orgContent},a.prototype.destroyDot=function(a){a.preventDefault(),a.stopPropagation(),this.unbind_events().contents().remove(),this.append(this.orgContent).attr("style",this.data("dotdotdot-style")||"").data("dotdotdot",!1)},a.prototype.windowWatcher=function(){var a,b,c;return"window"===this.dot.opts.watch&&(b=angular.element(this.dot),this.$scope.$watch(this.getWindowDimensions,function(){return b.triggerHandler("update.dot")},!0),a=this.$scope,c=function(){return a.$apply()},this.$scope.$on("$destroy",function(a){return function(){return angular.element(a.$window).unbind("resize",c)}}(this)),angular.element(this.$window).bind("resize",c)),this.dot},a.prototype.getWindowDimensions=function(){return{h:this.$window.innerHeight,w:this.$window.innerWidth}},a.prototype.loadDot=function(){var a,b;return a=angular.element(this.dot),a.data("dotdotdot")&&a.triggerHandler("destroy.dot"),a.data("dotdotdot-style",a.attr("style")||""),a.css("word-wrap","break-word"),"nowrap"===a.css("white-space")&&a.css("white-space","normal"),a.bind_events=function(b){return function(){return a.bind("update.dot",b.update).bind("isTruncated.dot",b.truncated).bind("originalContent.dot",b.getOriginalContent).bind("destroy.dot",b.destroyDot),a}}(this),a.unbind_events=function(){return a.unbind("update.dot"),a.unbind("isTruncated.dot"),a.unbind("originalContent.dot"),a.unbind("destroy.dot"),a},this.dot.watch=this.windowWatcher,this.dot.orgContent=a.contents(),b=this.$scope.dotOptions||{},this.dot.opts=angular.extend({},this.defaults,b,{after:null}),this.dot.conf={},this.dot.$inr=null,this.dot.opts.lastCharacter.remove instanceof Array||(this.dot.opts.lastCharacter.remove=this.defaultArrays.lastCharacter.remove),this.dot.opts.lastCharacter.noEllipsis instanceof Array||(this.dot.opts.lastCharacter.noEllipsis=this.defaultArrays.lastCharacter.noEllipsis),this.dot.conf.afterElement=j(this.dot.opts.after,a),this.dot.conf.isTruncated=!1,this.dot.conf.dotId=f++,a.data("dotdotdot",!0).bind_events().triggerHandler("update.dot"),this.dot.opts.watch&&this.dot.watch(),a},f=1,e=function(a,b,c){var d,e,f,g,h;for(e=a.children(),g=!1,a.empty(),f=0,h=e.length;h>f;){if(d=e.eq(f),a.append(d),c&&a.append(c),s(a,b)){d.remove(),g=!0;break}c&&c.remove(),f++}return g},g=function(a,b,c,d,e){var f,i,j;return f=!1,i=["a table","thead","tbody","tfoot","tr","col","colgroup","object","embed","param","ol","ul","dl","blockquote","select","optgroup","option","textarea","script","style"],j=["script",".dotdotdot-keep"],angular.forEach(a.contents().remove(),function(k){var l;return l=angular.element(k),"undefined"==typeof k||3===k.nodeType&&0===k.data.trim().length?!0:q(l,j)?a.append(l):f?!0:(a.append(l),e&&1===k.nodeType&&a[q(a,i)?"after":"append"](e),s(c,d)&&(f=3===k.nodeType?h(l,b,c,d,e):g(l,b,c,d,e),f||(l.remove(),f=!0)),!f&&e?e.remove():void 0)}),f},q=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(!angular.isArray(b))throw Error("types must be an array");if(a instanceof angular.element){for(e=0,g=a.length;g>e;e++)if(d=a[e],q(d,b))return!0;return!1}if("#text"===a.nodeName)return!1;for(f=0,h=b.length;h>f;f++){if(l=b[f],!angular.isString(l)&&0!==l.length)throw Error("type element must be set as string and must have length");if("."===l[0]){if(angular.element(a).hasClass(l))return!0}else{for(k=l.split(" "),i=!0,c=a;c&&(j=k.shift());)if(""!==j){if(c.nodeName.toLowerCase()!==j.toLowerCase()){i=!1;break}c=c.firstChild}if(i&&0===k.length)return!0}}return!1},h=function(a,c,d,e,f){var g,h,j,k,l,n,o,p,q,t,u,v;if(j=a[0],!j)return!1;for(v=m(j),q=-1!==v.indexOf(" ")?" ":"　",p="letter"===e.wrap?"":q,u=v.split(p),o=-1,n=-1,t=0,k=u.length-1,e.fallbackToLetter&&0===t&&0===k&&(p="",u=v.split(p),k=u.length-1);k>=t&&(0!==t||0!==k)&&(l=Math.floor((t+k)/2),l!==n);)n=l,r(j,u.slice(0,n+1).join(p)+e.ellipsis),s(d,e)?(k=n,e.fallbackToLetter&&0===t&&0===k&&(p="",u=u[0].split(p),o=-1,n=-1,t=0,k=u.length-1)):(o=n,t=n);return-1===o||1===u.length&&0===u[0].length?(g=a.parent(),a.remove(),h=f&&f.closest(g).length?f.length:0,g.contents().length>h?j=i(g.contents().eq(-1-h),c):(j=i(g,c,!0),h||g.remove()),j&&(v=b(m(j),e),r(j,v),h&&f&&angular.element(j).parent().append(f))):(v=b(u.slice(0,o+1).join(p),e),r(j,v)),!0},s=function(a,b){return a[0].clientHeight>b.maxHeight},b=function(a,b){for(;p(a.slice(-1),b.lastCharacter.remove)>-1;)a=a.slice(0,-1);return p(a.slice(-1),b.lastCharacter.noEllipsis)<0&&(a+=b.ellipsis),a},p=function(a,b,c){var e;if(b)for(e=b.length,c=c?0>c?Math.max(0,e+c):c:0;e>c;){if(d.call(b,c)>=0&&b[c]===a)return c;c++}return-1},t=function(a,b){var c;for(b=b.length?b[0]:b,c=a.length?a[0]:a;c.childNodes.length>0;)b.appendChild(c.childNodes[0]);return c.appendChild(b),a},l=function(a){return{width:a[0].clientWidth,height:a[0].clientHeight}},r=function(a,b){a.innerText?a.innerText=b:a.nodeValue?a.nodeValue=b:a.textContent&&(a.textContent=b)},m=function(a){return a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:""},k=function(a){for(;;)if(a=a.previousSibling,!a||1===a.nodeType||3===a.nodeType)break;return a},i=function(a,b,c){var d,e;if(d=a&&a[0],e=void 0,d){if(!c){if(3===d.nodeType)return d;if(a.text().trim())return i(angular.element(a.contents()[a.contents().length-1]),b)}for(e=k(d);!e;){if(a=a.parent(),a===b||!a.length)return!1;e=k(a[0])}if(e)return i(angular.element(e),b)}return!1},j=function(a,b){return a?"string"==typeof a?(a=angular.element(b[0].querySelector(a)),a.length?a:!1):a.jquery?a:!1:!1},n=function(a){var b,c,d,e,f;for(c=a.clientHeight,b=["paddingTop","paddingBottom"],f=0,d=b.length;d>f;)e=parseInt(o(a,b[f]),10),isNaN(e)&&(e=0),c-=e,f++;return c},o=function(a,b){return window.getComputedStyle?window.getComputedStyle(a)[b]:document.documentElement.currentStyle?a.currentStyle[b]:void 0},a}(),b=function(){var b;return b=Object.create(a.prototype),a.apply(b,arguments),b},angular.module("angular.dotdotdot",[]).directive("dotdotdot",["$window",b])}).call(this);